<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dhivya ‚ù§Ô∏è</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#e91e63">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Dhivya ‚ù§Ô∏è">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <style>
    :root{
      --bg1:#ffd6e7;
      --bg2:#fff0f6;
      --accent:#e91e63;
      --ink:#111;
      --card:#ffffffcc;
      --stroke:#ffe0ec;
      --shadow: 0 18px 60px rgba(0,0,0,.10);
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top, var(--bg2), var(--bg1));
      text-align:center;
      padding: 18px;
      overflow:hidden;
    }

    .stage{
      width: min(900px, 94vw);
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: clamp(22px, 4vw, 34px);
      backdrop-filter: blur(10px);
      position: relative;
      z-index: 2;
    }

    .title{
      margin:0 0 12px;
      font-size: clamp(20px, 3.8vw, 32px);
      color: var(--accent);
      font-weight: 900;
    }

    .question{
      font-size: clamp(24px, 5.2vw, 46px);
      font-weight: 950;
      margin: 10px 0 22px;
      color: var(--ink);
    }

    /* Buttons row */
    .btnRow{
      display:flex;
      justify-content:center;
      gap:12px;
      margin-top: 10px;
      position: relative;
      height: 64px;
    }

    button{
      border:0;
      border-radius: 16px;
      padding: 12px 18px;
      cursor:pointer;
      font-weight: 900;
      font-size: 16px;
      background: var(--accent);
      color: white;
      min-width: 120px;
      position: absolute;
      transition: transform .20s ease, left .22s ease, top .22s ease;
      box-shadow: 0 12px 22px rgba(233,30,99,.22);
      -webkit-tap-highlight-color: transparent;
    }
    #btnYes{ left: 18%; }
    #btnNo{ left: 62%; background:#111; box-shadow:none; }

    .hidden{ display:none !important; }

    /* Message-only screen */
    .note{
      margin: 4px 0 0;
      padding: clamp(18px, 3.8vw, 28px);
      border-radius: 22px;
      border: 2px solid rgba(233, 30, 99, .22);
      background: linear-gradient(135deg, #fff, #fff7fb);
      box-shadow: 0 10px 30px rgba(233,30,99,.10);
      font-size: clamp(22px, 4.9vw, 48px);
      line-height: 1.14;
      font-weight: 950;
      color: var(--ink);
    }
    .hint{
      margin-top: 12px;
      opacity: .68;
      font-size: 13px;
      user-select:none;
    }

    /* Typewriter love letter overlay */
    .overlay{
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(255, 214, 231, .55);
      backdrop-filter: blur(8px);
      z-index: 50;
    }
    .letter{
      width: min(900px, 94vw);
      background: #fff;
      border-radius: 26px;
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding: clamp(18px, 4vw, 30px);
      text-align:left;
      position: relative;
      overflow:hidden;
    }
    .letter h2{
      margin: 0 0 10px;
      color: var(--accent);
      font-size: clamp(18px, 3.4vw, 24px);
      font-weight: 900;
      text-align:center;
    }
    .type{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: clamp(14px, 2.8vw, 18px);
      line-height: 1.55;
      white-space: pre-wrap;
      margin: 0;
      min-height: 220px;
      color: #222;
    }
    .tap{
      margin-top: 14px;
      text-align:center;
      font-weight: 900;
      color: var(--accent);
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease;
    }
    .tap.show{
      opacity: 1;
      transform: translateY(0);
    }

    /* Heart burst animation */
    .burst{
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      pointer-events:none;
      z-index: 60;
    }
    .burst span{
      position:absolute;
      font-size: 22px;
      animation: pop 900ms ease-out forwards;
      will-change: transform, opacity;
    }
    @keyframes pop{
      0%{ transform: translate(0,0) scale(.6); opacity:0; }
      15%{ opacity:1; }
      100%{ transform: translate(var(--dx), var(--dy)) scale(1.2); opacity:0; }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .burst span{ animation: none; opacity:0; }
    }
  </style>
</head>

<body>
  <!-- Background music: upload an MP3 named music.mp3 in the same folder -->
  <audio id="bgMusic" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
  </audio>

  <main class="stage" role="main">
    <h1 class="title">Dhivya ‚ù§Ô∏è</h1>

    <!-- Screen 1 -->
    <section id="screenQuestion">
      <div class="question">Will you be my Valentine? üíò</div>
      <div class="btnRow">
        <button id="btnYes" type="button">Yes üíñ</button>
        <button id="btnNo" type="button">No üôà</button>
      </div>
    </section>

    <!-- Screen 2 -->
    <section id="screenMessage" class="hidden">
      <div class="note" id="note" aria-live="polite"></div>
      <div class="hint">Tap anywhere for the next message üíå</div>
    </section>
  </main>

  <!-- Love letter overlay (shows after YES) -->
  <div id="overlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Love letter">
    <div class="letter">
      <h2>For Dhivya ‚ù§Ô∏è</h2>
      <pre id="type" class="type"></pre>
      <div id="tap" class="tap">Tap to continue ‚ú®</div>
    </div>
  </div>

<script>
  // ---- Customize messages ----
  const notes = [
    "Dhivya, marrying you is the best decision of my life.",
    "Every day with you feels like a beautiful blessing.",
    "Your smile is my peace, my happiness, my world.",
    "Thank you for loving me and making life so special.",
    "I promise to stand with you forever and always.",
    "You are not just my wife, you are my heart ‚ù§Ô∏è"
  ];

  // Typewriter love letter
  const loveLetter =
`Dhivya,

From 01 March 2024, my life became brighter.
Thank you for your love, your patience, and your smile.

Today and always‚Ä¶ I choose you.
Will you be my forever Valentine? ‚ù§Ô∏è

‚Äî Arunvel`;

  // ---- Elements ----
  const screenQuestion = document.getElementById("screenQuestion");
  const screenMessage  = document.getElementById("screenMessage");
  const noteEl = document.getElementById("note");
  const btnNo = document.getElementById("btnNo");
  const btnYes = document.getElementById("btnYes");
  const overlay = document.getElementById("overlay");
  const typeEl = document.getElementById("type");
  const tapEl = document.getElementById("tap");
  const music = document.getElementById("bgMusic");

  let typingDone = false;
  let started = false;

  function newNote(){
    const n = notes[Math.floor(Math.random() * notes.length)];
    noteEl.textContent = n;
  }

  function goToMessages(){
    overlay.classList.add("hidden");
    screenQuestion.classList.add("hidden");
    screenMessage.classList.remove("hidden");
    newNote();
  }

  function heartBurst(){
    const burst = document.createElement("div");
    burst.className = "burst";
    const hearts = ["‚ù§Ô∏è","üíó","üíû","üíï","üíò"];
    for (let i = 0; i < 18; i++){
      const s = document.createElement("span");
      s.textContent = hearts[Math.floor(Math.random()*hearts.length)];
      const angle = Math.random() * Math.PI * 2;
      const dist = 80 + Math.random() * 140;
      const dx = Math.cos(angle) * dist;
      const dy = Math.sin(angle) * dist;
      s.style.setProperty("--dx", dx.toFixed(0) + "px");
      s.style.setProperty("--dy", dy.toFixed(0) + "px");
      s.style.left = "0px";
      s.style.top = "0px";
      s.style.fontSize = (18 + Math.random()*18).toFixed(0) + "px";
      s.style.animationDelay = (Math.random()*120).toFixed(0) + "ms";
      burst.appendChild(s);
    }
    document.body.appendChild(burst);
    setTimeout(() => burst.remove(), 1100);
  }

  async function startMusic(){
    try{
      await music.play();
    }catch(e){
      // iOS may block until user interaction; this runs on YES click so usually OK.
    }
  }

  function showLoveLetter(){
    overlay.classList.remove("hidden");
    typeEl.textContent = "";
    tapEl.classList.remove("show");
    typingDone = false;

    const speed = 24; // ms per character
    let i = 0;
    const timer = setInterval(() => {
      typeEl.textContent += loveLetter[i] || "";
      i++;
      if (i >= loveLetter.length){
        clearInterval(timer);
        typingDone = true;
        tapEl.classList.add("show");
      }
    }, speed);

    // Tap on overlay continues only after typing is done
    overlay.onclick = () => {
      if (!typingDone) return;
      goToMessages();
    };
  }

  // YES: heart burst + start music + typewriter letter
  btnYes.addEventListener("click", (e) => {
    e.stopPropagation();
    if (started) return;
    started = true;
    heartBurst();
    startMusic();
    showLoveLetter();
  });

  // NO button runs away
  function moveNo(){
    const stage = document.querySelector(".stage").getBoundingClientRect();
    const pad = 10;
    const maxX = Math.max(pad, stage.width - 130);
    const maxY = Math.max(pad, 70); // keep it near top-ish inside row

    const x = pad + Math.random() * (maxX - pad);
    const y = pad + Math.random() * (maxY - pad);

    btnNo.style.left = x + "px";
    btnNo.style.top = y + "px";
  }
  btnNo.addEventListener("mouseover", moveNo);
  btnNo.addEventListener("touchstart", moveNo, {passive:true});

  // Tap anywhere for next message (only after messages screen)
  document.addEventListener("click", () => {
    if (!screenMessage.classList.contains("hidden")) newNote();
  });

  // Service worker
  if ("serviceWorker" in navigator) {
  window.addEventListener("load", async () => {
    const reg = await navigator.serviceWorker.register("./sw.js");
    reg.update();
  });
}
</script>
</body>
</html>
